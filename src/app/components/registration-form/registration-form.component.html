<h4 class="text-center mb-4">User Registration</h4>

<div class="d-flex justify-content-center">
  <div class="card w-75 p-4 shadow-sm">
    @if (registrationStatus.message === "Not attempted yet") {
      <form [formGroup]="form" class="d-flex flex-column gap-3">
        <div class="row">
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Firstname</mat-label>
              <input matInput type="text" formControlName="firstName" />
              @if (
                form.get("firstName").invalid && form.get("firstName").touched
              ) {
                <mat-error>Firstname is required</mat-error>
              }
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Lastname</mat-label>
              <input matInput type="text" formControlName="lastName" />
              @if (
                form.get("lastName").invalid && form.get("lastName").touched
              ) {
                <mat-error>Lastname is required</mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>SSN</mat-label>
              <input matInput type="text" formControlName="ssn" />
              @if (form.get("ssn").invalid && form.get("ssn").touched) {
                <mat-error>SSN is required</mat-error>
              }
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Email</mat-label>
              <input
                matInput
                type="email"
                (blur)="checkDuplicateUsername()"
                formControlName="email"
              />
              @if (form.get("email").hasError("duplicateEmail")) {
                <mat-error>Email is already registered</mat-error>
              } @else if (
                form.get("email").hasError("required") &&
                form.get("email").touched
              ) {
                <mat-error>Email is missing or invalid</mat-error>
              } @else if (form.get("email").hasError("pattern")) {
                <mat-error>Please enter a valid email address</mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Password</mat-label>
              <input
                matInput
                type="password"
                formControlName="password"
                #passwordInput
              />
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="
                  passwordInput.type =
                    passwordInput.type === 'password' ? 'text' : 'password'
                "
              >
                <mat-icon>
                  {{
                    passwordInput.type === "password"
                      ? "visibility_off"
                      : "visibility"
                  }}
                </mat-icon>
              </button>
              @if (
                form.get("password")?.invalid && form.get("password")?.touched
              ) {
                <mat-error>Password is missing or invalid</mat-error>
              }
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Confirm Password</mat-label>
              <input
                matInput
                type="password"
                formControlName="confirmPassword"
                #confirmPasswordInput
              />
              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="
                  confirmPasswordInput.type =
                    confirmPasswordInput.type === 'password'
                      ? 'text'
                      : 'password'
                "
              >
                <mat-icon>
                  {{
                    confirmPasswordInput.type === "password"
                      ? "visibility_off"
                      : "visibility"
                  }}
                </mat-icon>
              </button>
              @if (form.get("confirmPassword").hasError("passwordMismatch")) {
                <mat-error>Passwords do not match</mat-error>
              } @else if (
                form.get("confirmPassword").invalid &&
                form.get("confirmPassword").touched
              ) {
                <mat-error>Confirmed Password is missing or invalid</mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <mat-form-field class="w-100">
          <mat-label>Phone</mat-label>
          <input matInput type="text" formControlName="phone" />
          @if (form.get("phone").invalid && form.get("phone").touched) {
            <mat-error>Phone is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field class="w-100">
          <mat-label>Address</mat-label>
          <input matInput type="text" formControlName="address" />
          @if (form.get("address").invalid && form.get("address").touched) {
            <mat-error>Phone is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field class="w-100">
            <mat-label>Address Number</mat-label>
            <input matInput type="text" formControlName="addressNumber" />
            @if (form.get("addressNumber").invalid && form.get("addressNumber").touched) {
              <mat-error>Phone is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field class="w-100">
            <mat-label>City</mat-label>
            <input matInput type="text" formControlName="city" />
            @if (form.get("city").invalid && form.get("city").touched) {
              <mat-error>Phone is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field class="w-100">
            <mat-label>Gender</mat-label>
            <input matInput type="text" formControlName="gender" />
            @if (form.get("gender").invalid && form.get("gender").touched) {
              <mat-error>Phone is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field class="w-100">
            <mat-label>Discound Card Number</mat-label>
            <input matInput type="text" formControlName="discountCardNumber" />
            @if (form.get("discountCardNumber").invalid && form.get("discountCardNumber").touched) {
              <mat-error>Phone is required</mat-error>
            }
          </mat-form-field>


  
  

        <button
          mat-flat-button
          color="primary"
          [disabled]="form.invalid"
          (click)="onSubmit(form.value)"
          class="align-self-end"
        >
          Register
        </button>
      </form>
    } @else {
      @if (registrationStatus.success) {
        <div class="alert alert-success mt-2">
          <strong>Success:</strong> {{ registrationStatus.message }}
        </div>
      } @else {
        <div class="alert alert-danger mt-2">
          <strong>Error:</strong> {{ registrationStatus.message }}
        </div>
      }
    }
  </div>
</div>
